name: GitHub CI
on:
  pull_request:
  workflow_dispatch:
  push:
    tags:
      - "*"
    branches:
      - main

env:
  ANSYSLMD_LICENSE_FILE: ${{ format('1055@{0}', secrets.LICENSE_SERVER) }}
  PYEDB_USE_DOTNET: '1'
  MAIN_PYTHON_VERSION: '3.10'
  PACKAGE_NAME: 'pyedb'
  DOCUMENTATION_CNAME: 'edb.docs.pyansys.com'
  IS_WORKFLOW_RUNNING: True
  ARTIFACTORY_VERSION: v242
  MEILISEARCH_API_KEY: ${{ secrets.MEILISEARCH_API_KEY }}
  MEILISEARCH_HOST_URL: ${{ vars.MEILISEARCH_HOST_URL }}
  MEILISEARCH_PUBLIC_API_KEY: ${{ secrets.MEILISEARCH_PUBLIC_API_KEY }}

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:

# =================================================================================================
# vvvvvvvvvvvvvvvvvvvvvvvvvvvvvv    RUNNING ON SELF-HOSTED RUNNER    vvvvvvvvvvvvvvvvvvvvvvvvvvvvvv
# =================================================================================================

  docs-build:
    name: Build documentation
    runs-on: [ Windows, self-hosted, pyedb ]
    timeout-minutes: 480
    steps:
      - name: Run doc build action
        uses: ansys/actions/doc-build@feat/doc-build-upload-assets
        with:
          python-version: ${{ env.MAIN_PYTHON_VERSION }}
          check-links: false
          add-pdf-html-docs-as-assets: true

  # docs-build-windows-github-runner:
  #   name: Build documentation
  #   runs-on: windows-latest
  #   timeout-minutes: 480
  #   steps:
  #     - name: Run doc build action
  #       uses: ansys/actions/doc-build@feat/doc-build-upload-assets
  #       with:
  #         python-version: ${{ env.MAIN_PYTHON_VERSION }}
  #         check-links: false
  #         add-pdf-html-docs-as-assets: true

  docs-build-linux-github-runner:
    name: Build documentation
    runs-on: ubuntu-latest
    timeout-minutes: 480
    steps:
      - name: Run doc build action
        uses: ansys/actions/doc-build@feat/doc-build-upload-assets
        with:
          python-version: ${{ env.MAIN_PYTHON_VERSION }}
          check-links: false
          add-pdf-html-docs-as-assets: true

